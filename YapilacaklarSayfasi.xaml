<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:MyMauiApp.Models"
             xmlns:converters="clr-namespace:MyMauiApp.Converters"
             xmlns:local="clr-namespace:MyMauiApp"
             x:Class="MyMauiApp.YapilacaklarSayfasi"
             Title="Yapılacaklar">
    <ContentPage.Resources>
        <converters:BoolToTamamlaMetniConverter x:Key="BoolToTamamlaMetniConverter"/>
        <converters:BoolToTamamlaRenkConverter x:Key="BoolToTamamlaRenkConverter"/>
        <converters:BoolToTamamlaIconConverter x:Key="BoolToTamamlaIconConverter"/>
        <converters:BoolToBaslikStyleConverter x:Key="BoolToBaslikStyleConverter"/>
        <converters:BoolToMetinStyleConverter x:Key="BoolToMetinStyleConverter"/>

        <Style TargetType="Label" x:Key="GorevMetniStyle">
            <Setter Property="FontSize" Value="Small"/>
            <Setter Property="TextColor" Value="{AppThemeBinding Light=Black, Dark=White}"/>
        </Style>
        <Style TargetType="Label" x:Key="GorevBaslikStyle" BasedOn="{StaticResource GorevMetniStyle}">
            <Setter Property="FontAttributes" Value="Bold"/>
            <Setter Property="FontSize" Value="Large"/> 
        </Style>
        <Style TargetType="Label" x:Key="GorevTarihStyle" BasedOn="{StaticResource GorevMetniStyle}">
            <Setter Property="TextColor" Value="Gray"/>
        </Style>

        <Style TargetType="Label" x:Key="TamamlandiGorevMetniStyle" BasedOn="{StaticResource GorevMetniStyle}">
            <Setter Property="TextDecorations" Value="Strikethrough"/>
            <Setter Property="TextColor" Value="DarkGray"/>
        </Style>
        <Style TargetType="Label" x:Key="TamamlandiGorevBaslikStyle" BasedOn="{StaticResource GorevBaslikStyle}">
            <Setter Property="TextDecorations" Value="Strikethrough"/>
            <Setter Property="TextColor" Value="DarkGray"/>
        </Style>
    </ContentPage.Resources>
    
    <Grid RowDefinitions="Auto, *">
        <Button FontSize="Medium" FontAttributes="Bold" Grid.Row="0" Text="+ Görev Ekle" x:Name="GorevEkleButton" Clicked="GorevEkleButton_Clicked" Margin="10"/>
        
        <CollectionView Grid.Row="1" x:Name="GorevlerCollectionView" Margin="10,0,10,10" SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Gorev">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems Mode="Execute">
                                <SwipeItem Text="{Binding Tamamlandi, Converter={StaticResource BoolToTamamlaMetniConverter}}"
                                           BackgroundColor="{Binding Tamamlandi, Converter={StaticResource BoolToTamamlaRenkConverter}}"
                                           IconImageSource="{Binding Tamamlandi, Converter={StaticResource BoolToTamamlaIconConverter}}"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type local:YapilacaklarSayfasi}}, Path=ToggleTamamlandiCommand}"
                                           CommandParameter="{Binding .}"/>
                            </SwipeItems>
                        </SwipeView.RightItems>
                        <SwipeView.LeftItems>
                            <SwipeItems Mode="Execute">
                                <SwipeItem Text="Sil" 
                                           BackgroundColor="Red"
                                           IconImageSource="trash_icon.png"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type local:YapilacaklarSayfasi}}, Path=SilGorevCommand}"
                                           CommandParameter="{Binding .}"/>
                            </SwipeItems>
                        </SwipeView.LeftItems>
                        
                        <Border Padding="10" Margin="0,5" StrokeThickness="1">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="5"/>
                            </Border.StrokeShape>
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding Tamamlandi}" Value="True">
                                    <Setter Property="BackgroundColor" Value="LightGreen"/>
                                    <Setter Property="Stroke" Value="DarkGreen"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Border" Binding="{Binding Tamamlandi}" Value="False">
                                    <Setter Property="BackgroundColor" Value="Transparent"/>
                                    <Setter Property="Stroke" Value="LightGray"/>
                                </DataTrigger>
                            </Border.Triggers>
                            <VerticalStackLayout Spacing="5">
                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="5">
                                    <Label Grid.Column="0" Text="{Binding Baslik}" Style="{Binding Tamamlandi, Converter={StaticResource BoolToBaslikStyleConverter}}"/>
                                    <Button Grid.Column="1" Text="Düzenle" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type local:YapilacaklarSayfasi}}, Path=DuzenleGorevCommand}" 
                                            CommandParameter="{Binding .}" 
                                            FontSize="Micro" Padding="8,4" HeightRequest="30" VerticalOptions="Center"/>
                                </Grid>
                                <Label Text="{Binding Aciklama}" Style="{Binding Tamamlandi, Converter={StaticResource BoolToMetinStyleConverter}}"/>
                                <Label Text="{Binding BitisTarihiSaati, StringFormat='{0:dd.MM.yyyy HH:mm}'}" Style="{StaticResource GorevTarihStyle}"/>
                            </VerticalStackLayout>
                        </Border>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
            <CollectionView.EmptyView>
                <StackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="20">
                    <Label Text="Yapılacak listeniz boş." FontSize="Medium" TextColor="Gray"/>
                </StackLayout>
            </CollectionView.EmptyView>
        </CollectionView>
    </Grid>
</ContentPage>
